{% extends 'base.html.twig' %}

{% block title %}Hra - No Bad Choices{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
{% endblock %}

{% block body %}
    <header>
        <h1>{{ 'No Bad Choices'|upper }}</h1>
    </header>

    <main>
        <section class="game-text">
            <p id="location-text">{{ text }}</p>
        </section>
        
        <section id="choices">
            {% for choice in choices %}
                <button 
                    data-choice-id="{{ choice.id }}" 
                    class="choice-btn">
                    {{ choice.choiceText }}
                </button>
            {% endfor %}
        </section>

        <p>Dnešní datum: {{ "now"|date("d.m.Y H:i") }}</p>
    </main>

    <script>
        document.querySelectorAll('.choice-btn').forEach(button => {
            button.addEventListener('click', async (event) => {
                event.preventDefault();

                const choiceId = button.dataset.choiceId;

                const response = await fetch('{{ path('move') }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ choiceId })
                });

                if (response.ok) {
                    const data = await response.json();

                    document.getElementById('location-text').innerText = data.text;

                    const choicesContainer = document.getElementById('choices');
                    choicesContainer.innerHTML = ''; 

                    data.choices.forEach(choice => {
                        const btn = document.createElement('button');
                        btn.innerText = choice.choiceText;
                        btn.dataset.choiceId = choice.id;
                        btn.classList.add('choice-btn');
                        choicesContainer.appendChild(btn);
                        console.log('Nové tlačítko přidáno:', btn);
                    });
                } else {
                    console.error('Chyba při získávání nové pozice:', response.statusText);
                }
            });
        });
    </script>
{% endblock %}
